== Single node install using Assistent Installer

This represent the single node base seed cluster with correct partitioning applied.

=== Install aicli

.install-aicli.sh
[source,bash]
----
#!/bin/bash

sudo pip3 install -U aicli
sudo pip3 install -U assisted-service-client

----

=== Authenticate to Red Hat AI Service

..auth-aicli.sh
----
#!/bin/bash
echo "https://console.redhat.com/openshift/token"
export OFFLINETOKEN="token downloaded from above url"
alias aicli="aicli --offlinetoken $OFFLINETOKEN"
----

=== Create Cluster

- Download pullsecret from https://console.redhat.com/openshift/downloads

- Create manifests

.create_manifests.sh
----
mkdir manifests
cat >> manifests/99-var-partition.yaml << EOF
apiVersion: machineconfiguration.openshift.io/v1
kind: MachineConfig
metadata:
  labels:
    machineconfiguration.openshift.io/role: master
  name: 98-var-partition
spec:
  config:
    ignition:
      version: 3.2.0
    storage:
      disks:
        - device: /dev/vdb
          partitions:
            - label: varlibcontainers
              sizeMiB: 150000 # size of the partition
              startMiB: 220000 # space left for the CoreOS partition.
      filesystems:
        - device: /dev/disk/by-partlabel/varlibcontainers
          format: xfs
          mountOptions:
            - defaults
            - prjquota
          path: /var/lib/containers
    systemd:
      units:
        - contents: |-
            # Generated by Butane
            [Unit]
            Before=local-fs.target
            Requires=systemd-fsck@dev-disk-by\x2dpartlabel-varlibcontainers.service
            After=systemd-fsck@dev-disk-by\x2dpartlabel-varlibcontainers.service

            [Mount]
            Where=/var/lib/containers
            What=/dev/disk/by-partlabel/varlibcontainers
            Type=xfs
            Options=defaults,prjquota

            [Install]
            RequiredBy=local-fs.target
          enabled: true
          name: var-lib-containers.mount
EOF
----

- Create parameters file

.sno-bi-parameters.yaml
----
ssh_public_key: 'ssh-ed25519 AAAA user@example.com' # replace
base_dns_domain: pietersmalan.com # replace
openshift_version: 4.19.0 # set the correct OCP version
image_type: minimal-iso
static_network_config:
- interfaces:
    - name: eno1
      type: ethernet
      state: up
      ipv4:
        address:
        - ip: 10.0.1.218 # replace
          prefix-length: 25 # replace
        enabled: true
      mac-address: 52:54:00:d7:fe:31 # replace
  dns-resolver:
    config:
      server:
      - 10.0.1.1 # replace
  routes:
    config:
    - destination: 0.0.0.0/0
      next-hop-address: 10.0.1.1
      next-hop-interface: eno1
      table-id: 254
network_type: OVNKubernetes
----

- Create Cluster

.Create Cluster Commands
[source,bash]
----
aicli create cluster sno-bi -P pull_secret=./openshift_pull.json -P sno=true --paramfile sno-bi-parameters.yaml

aicli create manifests --dir ./manifests/ sno-bi

aicli create iso sno-bi

aicli download iso -p . sno-bi
----

